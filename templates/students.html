<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Students - Student Support Center</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="page">
    <header class="top-bar">
      <div class="logo-circle">SSC</div>
      <h1>Students</h1>
    </header>

    <main class="content">
      <div class="card hero">
        <h2>Students</h2>
        <p>List of all students currently in the system.</p>
        <p style="margin-top: 0.5rem;">
          <a href="{{ url_for('new_student') }}" class="button-link">+ Add Student</a>
          <a href="{{ url_for('home') }}" class="button-link secondary">‚Üê Back to Dashboard</a>
        </p>

        <form method="get" action="{{ url_for('list_students') }}" class="search-form">
          <input type="text"
                 name="search"
                 placeholder="Search by name..."
                 value="{{ search }}"
                 class="search-input">

          <!-- COUNTRY -->
          <select name="country" class="search-select">
            <option value="">All Countries</option>
            {% for country in countries %}
              <option value="{{ country }}" {% if country == country_filter %}selected{% endif %}>{{ country }}</option>
            {% endfor %}
          </select>

          <!-- GENDER -->
          <select name="gender" class="search-select">
            <option value="">All Genders</option>
            {% for g in genders %}
              <option value="{{ g }}" {% if g == gender_filter %}selected{% endif %}>{{ g }}</option>
            {% endfor %}
          </select>

          <!-- ZIP -->
          <select name="zip" class="search-select">
            <option value="">All ZIPs</option>
            {% for z in zips %}
              <option value="{{ z }}" {% if z == zip_filter %}selected{% endif %}>{{ z }}</option>
            {% endfor %}
          </select>

          <!-- VISIT FILTERS -->
          <select name="visits_op" class="search-select">
            <option value="">Visits: Any</option>
            <option value="<" {% if visits_op == "<" %}selected{% endif %}>&lt;</option>
            <option value="=" {% if visits_op == "=" %}selected{% endif %}>=</option>
            <option value=">" {% if visits_op == ">" %}selected{% endif %}>&gt;</option>
          </select>
          <input type="number" name="visits_num" value="{{ visits_num }}" placeholder="#" class="search-input small-input">

          <!-- ISSUE FILTERS -->
          <select name="issues_op" class="search-select">
            <option value="">Issues: Any</option>
            <option value="<" {% if issues_op == "<" %}selected{% endif %}>&lt;</option>
            <option value="=" {% if issues_op == "=" %}selected{% endif %}>=</option>
            <option value=">" {% if issues_op == ">" %}selected{% endif %}>&gt;</option>
          </select>
          <input type="number" name="issues_num" value="{{ issues_num }}" placeholder="#" class="search-input small-input">

          <!-- CRITICAL FILTER -->
          <select name="critical_filter" class="search-select">
            <option value="">Critical: Any</option>
            <option value="Yes" {% if critical_filter == "Yes" %}selected{% endif %}>Yes</option>
            <option value="No" {% if critical_filter == "No" %}selected{% endif %}>No</option>
          </select>

          <button type="submit" class="button-link">Filter</button>
        </form>

      </div>

      <div class="card">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>DOB</th>
              <th>Country</th>
              <th>Gender</th>
              <th>Consent</th>
              <th>ZIP</th>
              <th># Visits</th>
              <th># Issues</th>
              <th>Critical</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for s in students %}
              <tr>
                <td><a href="{{ url_for('view_student', student_id=s.student_id) }}">{{ s.student_id }}</a></td>
                <td>{{ s.name }}</td>
                <td>{{ s.dob }}</td>
                <td>{{ s.country_of_birth }}</td>
                <td>{{ s.gender }}</td>
                <td>{{ 'Yes' if s.consent else 'No' }}</td>
                <td>{{ s.zip_code }}</td>
                <td>{{ s.num_visits }}</td>
                <td>{{ s.num_issues }}</td>
                <td>{{ 'Yes' if s.critical else 'No' }}</td>
                <td>
                  <form method="post"
                        action="{{ url_for('delete_student', student_id=s.student_id) }}"
                        onsubmit="return confirm('Delete this student?');"
                        style="display:inline;">
                    <button type="submit" class="button-link secondary">Delete</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </main>
  </div>
</body>
</html>
